<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Recipe</title>
  </head>
  <body>
    <h1>Create Recipe</h1>

    <form id="ingredient-form" autocomplete="off"></form>
    <form id="step-form" autocomplete="off"></form>
    <form id="recipe-form" autocomplete="off">
      <h3 for="recipe-name-input">Name</h3>
      <input
        type="text"
        id="recipe-name-input"
        placeholder="The name of your recipe"
        required
      />
      <div>
        <h3>Ingredients</h3>
        <ul id="ingredients"></ul>
      </div>
      <div class="ingredient-inputs">
        <div class="ingredient-item">
          <label for="ingredient-amount-input">Amount</label>
          <input
            type="number"
            id="ingredient-amount-input"
            form="ingredient-form"
            required
          />
        </div>
        <div class="ingredient-item">
          <label for="ingredient-unit-input">Unit</label>
          <input
            type="unit"
            id="ingredient-unit-input"
            form="ingredient-form"
          />
        </div>
        <div class="ingredient-item">
          <label for="ingredient-name-input">Name</label>
          <input
            type="text"
            id="ingredient-name-input"
            form="ingredient-form"
            required
          />
        </div>
        <button id="add-ingredient" type="submit" form="ingredient-form">
          Add Ingredient
        </button>
      </div>

      <div>
        <h3>Method</h3>
        <ol id="steps"></ol>
        <input
          type="text"
          id="step-input"
          placeholder="Step instructions"
          form="step-form"
          required
        />
        <button id="add-step" type="submit" form="step-form">Add Step</button>
      </div>

      <button id="create-recipe" type="submit">Create Recipe</button>
    </form>
  </body>
  <template id="ingredient-template">
    <li class="ingredient">
      <p class="ingredient-text"></p>
    </li>
  </template>
  <template id="step-template">
    <li class="step">
      <p class="step-text"></p>
    </li>
  </template>

  <script>
    function createIngredientNode({ unit, name, amount }) {
      const ingredientTemplate = document.getElementById("ingredient-template");
      const ingredientNode = ingredientTemplate.content.cloneNode(true);

      ingredientNode.querySelector(
        ".ingredient-text"
      ).textContent = `${amount} ${unit} ${name}`;
      return ingredientNode;
    }

    function createStepNode({ step }) {
      const stepTemplate = document.getElementById("step-template");
      const stepNode = stepTemplate.content.cloneNode(true);

      stepNode.querySelector(".step-text").textContent = step;
      return stepNode;
    }
    document
      .getElementById("ingredient-form")
      .addEventListener("submit", (e) => {
        e.preventDefault();
        const ingredientData = {
          name: document.getElementById("ingredient-name-input").value,
          unit: document.getElementById("ingredient-unit-input").value,
          amount: document.getElementById("ingredient-amount-input").value,
        };
        const ingredientName = document.getElementById(
          "ingredient-name-input"
        ).value;
        const unit = document.getElementById("ingredient-unit-input").value;
        const ingredientNode = createIngredientNode(ingredientData);
        document.getElementById("ingredients").append(ingredientNode);
        document.getElementById("ingredient-form").reset();
      });

    document.getElementById("step-form").addEventListener("submit", (e) => {
      e.preventDefault();

      const step = document.getElementById("step-input").value;
      const stepNode = createStepNode({ step });
      document.getElementById("steps").append(stepNode);
      document.getElementById("step-form").reset();
    });

    document.getElementById("recipe-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const recipeName = document.getElementById("recipe-name-input").value;
      const ingredients = [
        ...document
          .getElementById("ingredients")
          .querySelectorAll(".ingredient-text"),
      ].map((stepText) => stepText.textContent);
      const steps = [
        ...document.getElementById("steps").querySelectorAll(".step-text"),
      ].map((stepText) => stepText.textContent);
      const recipeData = {
        name: recipeName,
        ingredients: ingredients,
        steps: steps,
        time: new Date().toLocaleString(),
      };

      const storedRecipes = window.localStorage.getItem("recipesKey");
      const recipes = storedRecipes ? JSON.parse(storedRecipes).recipes : [];
      console.log(recipeData, recipes);

      recipes.unshift(recipeData);
      window.localStorage.setItem("recipesKey", JSON.stringify({ recipes }));
      navigation.navigate("../index.html");
    });
  </script>

  <style>
    body {
      height: 100vh;
      font-family: Verdana;
      width: 100%;
      display: flex;
      align-items: center;
      flex-direction: column;
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
    }

    h3 {
      margin-bottom: 10px;
    }

    #recipe-name-input {
      width: 400px;
    }

    .ingredient-inputs {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    #ingredient-amount-input {
      width: 50px;
    }

    #ingredient-unit-input {
      width: 50px;
    }

    #ingredient-name-input {
      width: 150px;
    }

    .ingredient-item {
      display: flex;
      flex-direction: column;
      label {
        font-size: 12px;
      }
    }

    #steps {
      font-size: 14px;
    }

    #ingredients {
      font-size: 14px;
    }

    #create-recipe {
      margin-top: 20px;
    }
  </style>
</html>
